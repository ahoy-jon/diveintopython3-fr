<!DOCTYPE html>
<meta charset=utf-8>
<title>Packager des biblioth&egrave;ques Python - Plongez au c&oelig;ur de python 3</title>
<!--[if IE]><script src=j/html5.js></script><![endif]-->
<link rel=stylesheet href=dip3.css>
<style>
body{counter-reset:h1 16}
mark{display:inline}
</style>
<link rel=stylesheet media='only screen and (max-device-width: 480px)' href=mobile.css>
<link rel=stylesheet media=print href=print.css>
<meta name=viewport content='initial-scale=1.0'>
<form action=http://www.google.com/cse><div><input type=hidden name=cx value=014021643941856155761:l5eihuescdw><input type=hidden name=ie value=UTF-8>&nbsp;<input type=search name=q size=25 placeholder="powered by Google&trade;">&nbsp;<input type=submit name=root value=Recherchez></div></form>
<p>Vous &ecirc;tes ici: <a href=index.html>Home</a> <span class=u>&#8227;</span> <a href=table-of-contents.html#packaging>Plongez au c&oelig;ur de Python 3</a> <span class=u>&#8227;</span>
<p id=level>Niveau de difficult&eacute;: <span class=u title=advanced>&#x2666;&#x2666;&#x2666;&#x2666;&#x2662;</span>
<h1>Packager des biblioth&egrave;ques Python</h1>
<blockquote class=q>
<p><span class=u>&#x275D;</span> Vous trouverez que la honte c&#8217;est comme la douleur; on ne la ressent qu&#8217;une seule fois. <span class=u>&#x275E;</span><br>&mdash; Marquise de Merteuil, <a href=http://www.imdb.com/title/tt0094947/quotes><cite>Les liaisons dangereuses</cite></a>
</blockquote>
<p id=toc>&nbsp;
<h2 id=divingin>Lan&ccedil;ons nous</h2>
<p class=f>un navire de vrais artistes. Ou tout comme dit Steve Jobs. Voulez vous rendre un script Python, une biblioth&egrave;que, un framework (ndlt: kit de composants logiciels structurels, qui d&eacute;finissent les fondations ainsi que les grandes lignes de l&#8217;organisation de tout ou partie d&#8217;un logiciel, de son architecture), ou une application public? Excellent. Le monde a besoin de plus de code Python. Python 3 est livr&eacute; avec un framework appel&eacute; Distutils. Distutils est beaucoup de choses: un outil de construction (pour vous), un outil d&#8217;installation (pour les utilisateurs), un package de format de m&eacute;tadonn&eacute;es (pour les moteurs de recherche), et plus encore. Il s&#8217;int&egrave;gre avec le <a href=http://pypi.python.org/>Python Package Index</a> ("PyPI"), un r&eacute;f&eacute;rentiel central pour les biblioth&egrave;ques open source Python.

<p>Toutes ces facettes de Distutils gravitent autour du <i>script d&#8217;installation</i>, traditionnellement appel&eacute; <code>setup.py</code>. En fait, vous avez d&eacute;j&agrave; vu plusieurs scripts d&#8217;installation Distutils dans ce livre. Vous avez utilis&eacute; Distutils pour installer <code>httplib2</code> dans <a href=http-web-services.html#introducing-httplib2>Services Web HTTP</a> et une nouvelle fois pour installer <code>chardet</code> dans <a href=case-study-porting-chardet-to-python-3.html>l&#8217;&eacute;tude de cas: portage de <code>chardet</code> en Python 3</a>.

<p>Dans ce chapitre, vous apprendrez comment fonctionnent les scripts d&#8217;installation pour <code>chardet</code> et <code>httplib2</code>, et vous vous familiariserez avec le processus de publication de vos propres applications Python.

<pre class=pp><code># chardet's setup.py
from distutils.core import setup
setup(
    name = "chardet",
    packages = ["chardet"],
    version = "1.0.2",
    description = "Universal encoding detector",
    author = "Mark Pilgrim",
    author_email = "mark@diveintomark.org",
    url = "http://chardet.feedparser.org/",
    download_url = "http://chardet.feedparser.org/download/python3-chardet-1.0.1.tgz",
    keywords = ["encoding", "i18n", "xml"],
    classifiers = [
        "Programming Language :: Python",
        "Programming Language :: Python :: 3",
        "Development Status :: 4 - Beta",
        "Environment :: Other Environment",
        "Intended Audience :: Developers",
        "License :: OSI Approved :: GNU Library or Lesser General Public License (LGPL)",
        "Operating System :: OS Independent",
        "Topic :: Software Development :: Libraries :: Python Modules",
        "Topic :: Text Processing :: Linguistic",
        ],
    long_description = """\
Universal character encoding detector
-------------------------------------

Detects
 - ASCII, UTF-8, UTF-16 (2 variants), UTF-32 (4 variants)
 - Big5, GB2312, EUC-TW, HZ-GB-2312, ISO-2022-CN (Traditional and Simplified Chinese)
 - EUC-JP, SHIFT_JIS, ISO-2022-JP (Japanese)
 - EUC-KR, ISO-2022-KR (Korean)
 - KOI8-R, MacCyrillic, IBM855, IBM866, ISO-8859-5, windows-1251 (Cyrillic)
 - ISO-8859-2, windows-1250 (Hungarian)
 - ISO-8859-5, windows-1251 (Bulgarian)
 - windows-1252 (English)
 - ISO-8859-7, windows-1253 (Greek)
 - ISO-8859-8, windows-1255 (Visual and Logical Hebrew)
 - TIS-620 (Thai)

This version requires Python 3 or later; a Python 2 version is available separately.
"""
)</code></pre>

<blockquote class=note>
    <p><span class=u>&#x261E;</span><code>chardet</code> et <code>httplib2</code> sont open source, mais il n&#8217;y a pas d&#8217;obligation que vous publiez vos biblioth&egrave;ques Python personnelles sous une licence en particulier. Le proc&eacute;d&eacute; d&eacute;crit dans ce chapitre fonctionnera pour n&#8217;importe quel logiciel Python, ind&eacute;pendamment de toute licence.
</blockquote>

<p class=a>&#x2042;

<h2 id=cantdo>Les choses que Distutils ne peut pas faire pour vous</h2>

<p>Sortir votre premier package Python est un processus intimidant. (Sortir le second est un peu plus facile.) Distutils essaye d&#8217;automatiser autant que possible, mais il ya certaines choses que vous devez tout simplement faire vous-m&ecirc;me.

<ul>
<li><b>Choisir une licence</b>. Il s&#8217;agit d&#8217;un sujet compliqu&eacute;, lourd de politique et plein de p&eacute;rils. Si vous souhaitez publier vos logiciels en open source, je propose humblement cinq fragments de conseils:

<ol>
<li>N&#8217;&eacute;crivez pas votre propre licence.
<li>N&#8217;&eacute;crivez pas votre propre licence.
<li>N&#8217;&eacute;crivez pas votre propre licence.
<li>Elle n&#8217;a pas besoin d&#8217;&ecirc;tre <abbr>GPL</abbr>, mais <a href=http://www.dwheeler.com/essays/gpl-compatible.html>elle doit &ecirc;tre <abbr>GPL</abbr>-compatible</a>.
<li>N&#8217;&eacute;crivez pas votre propre licence.
</ol>
<li><b>Classez vos logiciels </b> en utilisant le syst&egrave;me de classification PyPI. J&#8217;expliquerais ce que cela signifie plus loin dans ce chapitre.
<li><b>R&eacute;diger un fichier &#8220;lisez moi&#8221;</b>. Ne l&eacute;sinez pas sur ce point. Au minimum, il convient de donner &agrave; vos utilisateurs un aper&ccedil;u de ce que votre logiciel fait et de comment l&#8217;installer.
</ul>

<p class=a>&#x2042;

<h2 id=structure>Structure de r&eacute;pertoire</h2>

<p>Pour commencer &agrave; packager votre logiciel Python, vous devez avoir ordonn&eacute; vos fichiers et vos r&eacute;pertoires. Le r&eacute;pertoire <code>httplib2</code> ressemble &agrave; ceci:

<pre class=screen>
<a>httplib2/                 <span class=u>&#x2460;</span></a>
|
<a>+--README.txt             <span class=u>&#x2461;</span></a>
|
<a>+--setup.py               <span class=u>&#x2462;</span></a>
|
<a>+--httplib2/              <span class=u>&#x2463;</span></a>
   |
   +--__init__.py
   |
   +--iri2uri.py</pre>
<ol>
<li>Cr&eacute;ez un r&eacute;pertoire racine pour contenir le tout. Donnez-lui le m&ecirc;me nom que votre module Python.
<li>Pour arranger les utilisateurs de Windows, votre fichier "lisez-moi" devrait inclure une extension <code>.txt</code>, et il devrait utiliser les retours de chariot de style Windows. Le fait que <em>vous</em> utilisiez un &eacute;diteur de texte sophistiqu&eacute; qui fonctionne  &agrave; partir de la ligne de commande et poss&egrave;de son propre langage de macros, ne vous donne pas le droit de menetr la vie dure &agrave; vos utilisateurs. (Vos utilisateurs utilisent le bloc-notes. Triste mais vrai.) M&ecirc;me si vous &ecirc;tes sous Linux ou MAC OS X, votre &eacute;diteur de texte sophistiqu&eacute; a sans aucun doute une option permettant d&#8217;enregistrer des fichiers avec un retour chariot de style Windows.
<li>Votre script d&#8217;installation Distutils devrait &ecirc;tre nomm&eacute; <code>setup.py</code> &agrave; moins que vous n&#8217;ayez une bonne raison de ne pas le faire. Vous n&#8217;avez pas de bonne raison de ne pas le faire.
<li>Si votre logiciel Python est un simple fichier <code>.py</code>, vous devriez le mettre dans le r&eacute;pertoire racine entre votre fichier &#8220;lisez-moi&#8221; file et votre script d&#8217;installation. Mais <code>httplib2</code> n&#8217;est pas un simple fichier <code>.py</code>; c&#8217;est <a href=case-study-porting-chardet-to-python-3.html#multifile-modules>un module multi-fichiers</a>. Mais &ccedil;a roule! Mettez juste le r&eacute;pertoire <code>httplib2</code> dans le r&eacute;pertoire racine, vous avez donc un fichier <code>__init__.py</code> &agrave; l&#8217;int&eacute;rieur d&#8217;un r&eacute;pertoire <code>httplib2/</code> &agrave; l&#8217;int&eacute;rieur du r&eacute;pertoire racine <code>httplib2/</code>. Ce n&#8217;est pas un probl&egrave;me; en fait, cela simplifiera votre processus de packaging.
</ol>

<p>Le r&eacute;pertoire <code>chardet</code> &agrave; l&#8217;air l&eacute;g&egrave;rement diff&eacute;rent . Tout comme <code>httplib2</code>, c&#8217;est <a href=case-study-porting-chardet-to-python-3.html#multifile-modules>un module multi-fichiers</a>, il y a donc un r&eacute;pertoire <code>chardet/</code> &agrave; l&#8217;int&eacute;rieur du r&eacute;pertoire racine <code>chardet/</code>. En plus du fichier <code>README.txt</code>, <code>chardet</code> poss&egrave;de une documentation au format <abbr>HTML</abbr> dans le r&eacute;pertoire <code>docs/</code>. Le r&eacute;pertoire <code>docs/</code> contient plusieurs fichiers <code>.html</code> et <code>.css</code> et un sous-r&eacute;pertoire <code>images/</code>, qui contient plusieurs <code>.png</code> et <code>.gif</code>. (Ce sera important pour la suite.) De plus, conform&eacute;ment &agrave; la convention pour les logiciels sous licence <abbr>(L)GPL</abbr>, il contient un fichier s&eacute;par&eacute; appel&eacute; <code>COPYING.txt</code> qui contient le texte complet de la <abbr>LGPL</abbr>.

<pre class=nd><code>
chardet/
|
+--COPYING.txt
|
+--setup.py
|
+--README.txt
|
+--docs/
|  |
|  +--index.html
|  |
|  +--usage.html
|  |
|  +--images/ ...
|
+--chardet/
   |
   +--__init__.py
   |
   +--big5freq.py
   |
   +--...
</code></pre>

<p class=a>&#x2042;

<h2 id=setuppy>R&eacute;daction de votre script d&#8217;installation</h2>

<p>Le script d&#8217;installation Distutils est un script Python. En th&eacute;orie, il peut faire tout ce que Python peut faire. Dans la pratique, il devrait le faire aussi peu que possible, de fa&ccedil;on aussi standard que possible. Les scripts d&#8217;installation devraient &ecirc;tre ennuyeux.Setup scripts should be boring. Plus votre processus d&#8217;installation est exotique, plus vos rapports de bogues le seront.

<p>La premi&egrave;re ligne de chaque script de d&#8217;installation de Distutils est toujours la m&ecirc;me:

<pre class='nd pp'><code>from distutils.core import setup</code></pre>

<p>Ceci importe la fonction <code>setup()</code>, qui est le point d&#8217;entr&eacute;e principal de Distutils. 95% de tous les scripts d&#8217;installation Distutils ne se composent que d&#8217;un seul appel &agrave; <code>setup()</code> et de rien d&#8217;autre. (Je viens juste d&#8217;inventer cette statistique de toutes pi&egrave;ces, mais si votre script d&#8217;installation Distutils fait plus que d&#8217;appeler la fonction <code>setup()</code> de Distutils, vous devriez avoir une bonne raison. Avez-vous une bonne raison? Je ne crois pas.)

<p>La fonction <code>setup()</code> <a href=http://docs.python.org/3.1/distutils/apiref.html#distutils.core.setup>peut prendre des dizaines de param&egrave;tres</a>. Pour la sant&eacute; mentale de tous les int&eacute;ress&eacute;s, vous devez utiliser <a href=your-first-python-program.html#optional-arguments>des arguments nomm&eacute;s</a> pour chaque param&egrave;tre. Ce n&#8217;est pas seulement une convention, c&#8217;est une exigence difficile. Votre script d&#8217;installation plantera si vous essayez d&#8217;appeler la fonction <code>setup()</code> avec des arguments non-nomm&eacute;s.

<p>Les arguments nommés suivants sont indispensables:

<ul>
<li><b>name</b>, le nom du package.
<li><b>version</b>, le num&eacute;ro de version du package.
<li><b>author</b>, votre nom complet.
<li><b>author_email</b>, votre adresse email.
<li><b>url</b>, la page d&#8217;accueil de votre projet. Ceci peut &ecirc;tre votre page de package <a href=http://pypi.python.org/>PyPI</a> si vous n&#8217;avez pas de site web s&eacute;par&eacute; pour le projet.
</ul>

<p>Bien que non requis, je vous recommande &eacute;galement d&#8217;inclure les &eacute;l&eacute;ments suivants dans votre script d&#8217;installation:

<ul>
<li><b>description</b>, un r&eacute;sum&eacute; en une ligne du projet.
<li><b>long_description</b>, une cha&icirc;ne de caract&egrave;res multi-ligne en <a href=http://docutils.sourceforge.net/rst.html>format reStructuredText</a>. <a href=http://pypi.python.org/>PyPI</a> convertit ceci en <abbr>HTML</abbr> et l&#8217;affiche dans votre page de package.
<li><b>classifiers</b>, une liste de cha&icirc;nes de caract&egrave;res sp&eacute;cialement format&eacute;es d&eacute;crite dans la section suivante.
</ul>

<blockquote class=note>
<p><span class=u>&#x261E;</span>Les m&eacute;tadonn&eacute;es du script d&#8217;installation sont d&eacute;finies dans <a href=http://www.python.org/dev/peps/pep-0314/><abbr>PEP</abbr> 314</a>.
</blockquote>

<p>Maintenant, jettons un &oelig;il au script d&#8217;installation <code>chardet</code>. Il contient tous ces param&egrave;tres requis et recommand&eacute;, plus un que je n&#8217;ai pas encore mentionn&eacute;: <code>packages</code>.

<pre class='nd pp'><code>from distutils.core import setup
setup(
    name = 'chardet',
    <mark>packages = ['chardet']</mark>,
    version = '1.0.2',
    description = 'Universal encoding detector',
    author='Mark Pilgrim',
    ...
)</code></pre>

<p>Le param&egrave;tre <code>packages</code> met en &eacute;vidence une maheureuse co&iuml;ncidence dans le processus de distribution. Nous sommes en train de parler du &#8220;package&#8221; en tant que choses que vous construisez (et potentiellement une liste dans le Python &#8220;Package&#8221; Index). Mais ce n&#8217;est pas ce &agrave; quoi ce param&egrave;tre <code>packages</code> se r&eacute;f&egrave;re. Il se r&eacute;f&egrave;re au fait que le module <code>chardet</code> est <a href=case-study-porting-chardet-to-python-3.html#multifile-modules>un module multi-fichier</a>, parfois connu en tant que&hellip; &#8220;package.&#8221; Le param&egrave;tre <code>packages</code> indique &agrave; Distutils d&#8217;inclure le r&eacute;pertoire <code>chardet/</code>, son fichier <code>__init__.py</code>, et tout les autres fichiers <code>.py</code> qui constituent le module <code>chardet</code>. Cela a une esp&egrave;ce d&#8217;importance; toutes ces belles paroles sur la documentation et les m&eacute;tadonn&eacute;es sont sans objet si vous oubliez d&#8217;inclure le code actuel!

<p class=a>&#x2042;

<h2 id=trove>Classifier votre package</h2>

<p>Le Python Package Index (&#8220;PyPI&#8221;) contient des milliers de biblioth&egrave;ques Python. Une classification correcte des metadonn&eacute;es permettra aux gens de trouver votre exemplaire plus facilement. PyPI vous permet <a href='http://pypi.python.org/pypi?:action=browse'>de parcourir les paquets &agrave; l&#8217;aide de classificateurs</a>. Vous pouvez m&egrave;me s&eacute;lectionner plusieurs classificateurs afin d&#8217;affiner votre recherche. Les classificateurs ne sont pas des metadonn&eacute;es invisibles que vous pouvez vous contenter d&#8217;ignorer!

<p>Pour classifier votre logiciel, passez un param&egrave;tre de l&#8217;un des <code>classificateurs</code> &agrave; la fonction <code>setup()</code> de Distutils. Le param&egrave;tre des <code>classificateurs</code> se pr&eacute;sente sous forme d&#8217;une liste de cha&icirc;nes de caract&egrave;res. Ces cha&icirc;nes de caract&egrave;res <em>ne sont pas</em> libres de forme. Toutes les cha&icirc;nes de caract&egrave;res des classificateurs devrait provenir de <a href='http://pypi.python.org/pypi?:action=list_classifiers'>cette liste de PyPI</a>.

<p>Les classificateurs sont optionnels. Vous pouvez &eacute;crire un script d&#8217;innstallation Distutils sans aucun classificateur du tout. <strong>Ne le fa&icirc;tes pas.</strong> Vous devriez <em>toujours</em> inclure au moins ces classificateurs:

<ul>
<li><b>Programming Language</b>. En particulier, vous devriez inclure &agrave; la fois <code>"Programming Language :: Python"</code> et &agrave; la fois <code>"Programming Language :: Python :: 3"</code>. Si vous ne les incluez pas, votre package ne ressortira pas de <a href='http://pypi.python.org/pypi?:action=browse&amp;c=533&amp;show=all'>cette liste de biblioth&egrave;ques compatibles Python 3</a>, qui sont accessible &agrave; partir de chaque page de <code>pypi.python.org</code> depuis le menu lat&eacute;ral.
<li><b>License</b>. Ceci est <em>la premi&egrave;re chose que je recherche en priorit&eacute;</em> quand j&#8217;&eacute;value des biblioth&egrave;ques tierces. Ne me donnez pas la chasse pour cette information vitale. N&#8217;incluez pas plus d&#8217;un classificateur de licence &agrave; moins que votre logiciel soit explicitement sous de multiples licences. (Et ne diffusez pas de logiciels sous des licences multiples &agrave; moins que vous ne soyez forc&eacute; de faire ainsi. Et ne forcez pas d&#8217;autres gens &agrave; le faire non plus. Le choix des licences fait suffisamment mal &agrave; la t&ecirc;te comme &ccedil;a; ne le rendez pas plus douloureux.)
<li><b>Operating System</b>. Si votre logiciel ne fonctionne que sous Windows (ou Mac OS X, ou Linux), je veux le savoir plut&ocirc;t trop t&ocirc;t que trop tard. Si votre logiciel fonctionne partout sans aucun code sp&eacute;cifique &agrave; la plateforme, utilisez le classificateur <code>"Operating System :: OS Independent"</code>. Des classificateurs <code>Operating System</code> multiples ne sont n&eacute;cessaire seulement si votre logiciel requiert un support sp&eacute;cifique pour chaque plate-forme. (Ce qui n&#8217;est pas commun.)
</ul>

<p>Je vous recommande aussi d&#8217;inclure les classificateurs suivants:

<ul>
<li><b>Development Status</b>. Votre logiciel est-il de qualit&eacute; beta? De qualit&eacute; alpha? Pre-alpha? Choisissez-en une. Soyez honn&ecirc;te.
<li><b>Intended Audience</b>. Qui compte t&eacute;l&eacute;charger votre logiciel? Les choix les plus courants sont <code>Developers</code>, <code>End Users/Desktop</code>, <code>Science/Research</code>, et <code>System Administrators</code>.
<li><b>Framework</b>. Si votre logiciel est un plugin pour un framework Python plus grand comme <a href=http://www.djangoproject.com/>Django</a> ou <a href=http://www.zope.org/>Zope</a>, incluez le classificateur appropri&eacute; du <code>Framework</code>. Sinon, omettez le.
<li><b>Topic</b>. Il y a <a href='http://pypi.python.org/pypi?:action=list_classifiers'>un grand nombre de th&egrave;mes au choix</a>; choisissez tous ceux qui correspondent.
</ul>

<h3 id=trove-examples>Exemples de bons classificateurs de package</h3>

<p>&Agrave; titre d&#8217;exemple, voici les classificateurs pour <a href=http://pypi.python.org/pypi/Django/>Django</a>, une application web de type framework, pr&ecirc;te &agrave; la production, multiplate-forme, sous licence <abbr>BSD</abbr> et qui fonctionne sur votre serveur web. (Django n&#8217;est pas compatible avec Python 3, le classificateur <code>Programming Language :: Python :: 3</code> n&#8217;est donc pas list&eacute;.)

<pre><code>Programming Language :: Python
License :: OSI Approved :: BSD License
Operating System :: OS Independent
Development Status :: 5 - Production/Stable
Environment :: Web Environment
Framework :: Django
Intended Audience :: Developers
Topic :: Internet :: WWW/HTTP
Topic :: Internet :: WWW/HTTP :: Dynamic Content
Topic :: Internet :: WWW/HTTP :: WSGI
Topic :: Software Development :: Libraries :: Python Modules</code></pre>

<p>Voici les classificateurs pour <a href=http://pypi.python.org/pypi/chardet><code>chardet</code></a>, la biblioth&egrave;que de d&eacute;tection des encodages de charact&egrave;re couverts dans les <a href=case-study-porting-chardet-to-python-3.html>&Eacute;tude de cas: Portage de <code>chardet</code> en Python 3</a>. <code>chardet</code> est de qualit&eacute; beta, multiplate-forme, compatible Python 3, sous licence <abbr>LGPL</abbr>, et destin&eacute; aux d&eacute;veloppeurs afin d&#8217;&ecirc;tre int&eacute;gr&eacute; &agrave; l&#8217int&eacute;rieur de leurs propres produits.

<pre><code>Programming Language :: Python
Programming Language :: Python :: 3
License :: OSI Approved :: GNU Library or Lesser General Public License (LGPL)
Operating System :: OS Independent
Development Status :: 4 - Beta
Environment :: Other Environment
Intended Audience :: Developers
Topic :: Text Processing :: Linguistic
Topic :: Software Development :: Libraries :: Python Modules</code></pre>

<p>Et voici les classificateurs pour <a href=http://pypi.python.org/pypi/httplib2><code>httplib2</code></a>, la biblioth&egrave;que figurant dans le chapitre <a href=http-web-services.html>Services Web <abbr>HTTP</abbr></a>. <code>httplib2</code> est de qualit&eacute; beta, multiplate-forme, sous licence <abbr>MIT</abbr>, et destin&eacute; aux d&eacute;veloppeurs Python.

<pre><code>Programming Language :: Python
Programming Language :: Python :: 3
License :: OSI Approved :: MIT License
Operating System :: OS Independent
Development Status :: 4 - Beta
Environment :: Web Environment
Intended Audience :: Developers
Topic :: Internet :: WWW/HTTP
Topic :: Software Development :: Libraries :: Python Modules</code></pre>

<h2 id=manifest>Specifying Additional Files With A Manifest</h2>

<p>By default, Distutils will include the following files in your release package:

<ul>
<li><code>README.txt</code>
<li><code>setup.py</code>
<li>The <code>.py</code> files needed by the multi-file modules listed in the <code>packages</code> parameter
<li>The individual <code>.py</code> files listed in the <code>py_modules</code> parameter
</ul>

<p>That will cover <a href=#structure>all the files in the <code>httplib2</code> project</a>. But for the <code>chardet</code> project, we also want to include the <code>COPYING.txt</code> license file and the entire <code>docs/</code> directory that contains images and  <abbr>HTML</abbr> files. To tell Distutils to include these additional files and directories when it builds the <code>chardet</code> release package, you need a <i>manifest file</i>.

<p>A manifest file is a text file called <code>MANIFEST.in</code>. Place it in the project&#8217;s root directory, next to <code>README.txt</code> and <code>setup.py</code>. Manifest files are <em>not</em> Python scripts; they are text files that contain a series of &#8220;commands&#8221; in a Distutils-defined format. Manifest commands allow you to include or exclude specific files and directories.

<p>This is the entire manifest file for the <code>chardet</code> project:

<pre class=nd><code><a>include COPYING.txt                                <span class=u>&#x2460;</span></a>
<a>recursive-include docs *.html *.css *.png *.gif    <span class=u>&#x2461;</span></a></code></pre>
<ol>
<li>The first line is self-explanatory: include the <code>COPYING.txt</code> file from the project&#8217;s root directory.
<li>The second line is a bit more complicated. The <code>recursive-include</code> command takes a directory name and one or more filenames. The filenames aren&#8217;t limited to specific files; they can include wildcards. This line means &#8220;See that <code>docs/</code> directory in the project&#8217;s root directory? Look in there (recursively) for <code>.html</code>, <code>.css</code>, <code>.png</code>, and <code>.gif</code> files. I want all of them in my release package.&#8221;
</ol>

<p>All manifest commands preserve the directory structure that you set up in your project directory. That <code>recursive-include</code> command is not going to put a bunch of <code>.html</code> and <code>.png</code> files in the root directory of the release package. It&#8217;s going to maintain the existing <code>docs/</code> directory structure, but only include those files inside that directory that match the given wildcards. (I didn&#8217;t mention it earlier, but the <code>chardet</code> documentation is actually written in <abbr>XML</abbr> and converted to <abbr>HTML</abbr> by a separate script. I don&#8217;t want to include the <abbr>XML</abbr> files in the release package, just the <abbr>HTML</abbr> and the images.)

<blockquote class=note>
<p><span class=u>&#x261E;</span>Manifest files have their own unique format. See <a href=http://docs.python.org/3.1/distutils/sourcedist.html#manifest>Specifying the files to distribute</a> and <a href=http://docs.python.org/3.1/distutils/commandref.html#sdist-cmd>the manifest template commands</a> for details.
</blockquote>

<p>To reiterate: you only need to create a manifest file if you want to include files that Distutils doesn&#8217;t include by default. If you do need a manifest file, it should only include the files and directories that Distutils wouldn&#8217;t otherwise find on its own.

<h2 id=check>Checking Your Setup Script for Errors</h2>

<p>There&#8217;s a lot to keep track of. Distutils comes with a built-in validation command that checks that all the required metadata is present in your setup script. For example, if you forget to include the <code>version</code> parameter, Distutils will remind you.

<pre class=screen>
<samp class=p>c:\Users\pilgrim\chardet> </samp><kbd>c:\python31\python.exe setup.py check</kbd>
<samp>running check
warning: check: missing required meta-data: version</samp></pre>

<p>Once you include a <code>version</code> parameter (and all the other required bits of metadata), the <code>check</code> command will look like this:

<pre class=screen>
<samp class=p>c:\Users\pilgrim\chardet> </samp><kbd>c:\python31\python.exe setup.py check</kbd>
<samp>running check</samp></pre>

<p class=a>&#x2042;

<h2 id=sdist>Creating a Source Distribution</h2>

<p>Distutils supports building multiple types of release packages. At a minimum, you should build a &#8220;source distribution&#8221; that contains your source code, your Distutils setup script, your &#8220;read me&#8221; file, and whatever <a href=#manifest>additional files you want to include</a>. To build a source distribution, pass the <code>sdist</code> command to your Distutils setup script.

<pre class=screen>
<samp class=p>c:\Users\pilgrim\chardet> </samp><kbd><mark>c:\python31\python.exe setup.py sdist</mark></kbd>
<samp>running sdist
running check
reading manifest template 'MANIFEST.in'
writing manifest file 'MANIFEST'
creating chardet-1.0.2
creating chardet-1.0.2\chardet
creating chardet-1.0.2\docs
creating chardet-1.0.2\docs\images
copying files to chardet-1.0.2...
copying COPYING -> chardet-1.0.2
copying README.txt -> chardet-1.0.2
copying setup.py -> chardet-1.0.2
copying chardet\__init__.py -> chardet-1.0.2\chardet
copying chardet\big5freq.py -> chardet-1.0.2\chardet
...
copying chardet\universaldetector.py -> chardet-1.0.2\chardet
copying chardet\utf8prober.py -> chardet-1.0.2\chardet
copying docs\faq.html -> chardet-1.0.2\docs
copying docs\history.html -> chardet-1.0.2\docs
copying docs\how-it-works.html -> chardet-1.0.2\docs
copying docs\index.html -> chardet-1.0.2\docs
copying docs\license.html -> chardet-1.0.2\docs
copying docs\supported-encodings.html -> chardet-1.0.2\docs
copying docs\usage.html -> chardet-1.0.2\docs
copying docs\images\caution.png -> chardet-1.0.2\docs\images
copying docs\images\important.png -> chardet-1.0.2\docs\images
copying docs\images\note.png -> chardet-1.0.2\docs\images
copying docs\images\permalink.gif -> chardet-1.0.2\docs\images
copying docs\images\tip.png -> chardet-1.0.2\docs\images
copying docs\images\warning.png -> chardet-1.0.2\docs\images
creating dist
creating 'dist\chardet-1.0.2.zip' and adding 'chardet-1.0.2' to it
adding 'chardet-1.0.2\COPYING'
adding 'chardet-1.0.2\PKG-INFO'
adding 'chardet-1.0.2\README.txt'
adding 'chardet-1.0.2\setup.py'
adding 'chardet-1.0.2\chardet\big5freq.py'
adding 'chardet-1.0.2\chardet\big5prober.py'
...
adding 'chardet-1.0.2\chardet\universaldetector.py'
adding 'chardet-1.0.2\chardet\utf8prober.py'
adding 'chardet-1.0.2\chardet\__init__.py'
adding 'chardet-1.0.2\docs\faq.html'
adding 'chardet-1.0.2\docs\history.html'
adding 'chardet-1.0.2\docs\how-it-works.html'
adding 'chardet-1.0.2\docs\index.html'
adding 'chardet-1.0.2\docs\license.html'
adding 'chardet-1.0.2\docs\supported-encodings.html'
adding 'chardet-1.0.2\docs\usage.html'
adding 'chardet-1.0.2\docs\images\caution.png'
adding 'chardet-1.0.2\docs\images\important.png'
adding 'chardet-1.0.2\docs\images\note.png'
adding 'chardet-1.0.2\docs\images\permalink.gif'
adding 'chardet-1.0.2\docs\images\tip.png'
adding 'chardet-1.0.2\docs\images\warning.png'
removing 'chardet-1.0.2' (and everything under it)</samp></pre>

<p>Several things to note here:

<ul>
<li>Distutils noticed the manifest file (<code>MANIFEST.in</code>).
<li>Distutils successfully parsed the manifest file and added the additional files we wanted&nbsp;&mdash;&nbsp;<code>COPYING.txt</code> and the <abbr>HTML</abbr> and image files in the <code>docs/</code> directory.
<li>If you look in your project directory, you&#8217;ll see that Distutils created a <code>dist/</code> directory. Within the <code>dist/</code> directory the <code>.zip</code> file that you can distribute.
</ul>

<pre class=screen>
<samp class=p>c:\Users\pilgrim\chardet> </samp><kbd><mark>dir dist</mark></kbd>
<samp> Volume in drive C has no label.
 Volume Serial Number is DED5-B4F8

 Directory of c:\Users\pilgrim\chardet\dist

07/30/2009  06:29 PM    &lt;DIR>          .
07/30/2009  06:29 PM    &lt;DIR>          ..
07/30/2009  06:29 PM           206,440 <mark>chardet-1.0.2.zip</mark>
               1 File(s)        206,440 bytes
               2 Dir(s)  61,424,635,904 bytes free</samp></pre>

<p class=a>&#x2042;

<h2 id=bdist>Creating a Graphical Installer</h2>

<p>In my opinion, every Python library deserves a graphical installer for Windows users. It&#8217;s easy to make (even if you don&#8217;t run Windows yourself), and Windows users appreciate it.

<p>Distutils can <a href=http://docs.python.org/3.1/distutils/builtdist.html#creating-windows-installers>create a graphical Windows installer for you</a>, by passing the <code>bdist_wininst</code> command to your Distutils setup script.

<pre class=screen>
<samp class=p>c:\Users\pilgrim\chardet> </samp><kbd><mark>c:\python31\python.exe setup.py bdist_wininst</mark></kbd>
<samp>running bdist_wininst
running build
running build_py
creating build
creating build\lib
creating build\lib\chardet
copying chardet\big5freq.py -> build\lib\chardet
copying chardet\big5prober.py -> build\lib\chardet
...
copying chardet\universaldetector.py -> build\lib\chardet
copying chardet\utf8prober.py -> build\lib\chardet
copying chardet\__init__.py -> build\lib\chardet
installing to build\bdist.win32\wininst
running install_lib
creating build\bdist.win32
creating build\bdist.win32\wininst
creating build\bdist.win32\wininst\PURELIB
creating build\bdist.win32\wininst\PURELIB\chardet
copying build\lib\chardet\big5freq.py -> build\bdist.win32\wininst\PURELIB\chardet
copying build\lib\chardet\big5prober.py -> build\bdist.win32\wininst\PURELIB\chardet
...
copying build\lib\chardet\universaldetector.py -> build\bdist.win32\wininst\PURELIB\chardet
copying build\lib\chardet\utf8prober.py -> build\bdist.win32\wininst\PURELIB\chardet
copying build\lib\chardet\__init__.py -> build\bdist.win32\wininst\PURELIB\chardet
running install_egg_info
Writing build\bdist.win32\wininst\PURELIB\chardet-1.0.2-py3.1.egg-info
creating 'c:\users\pilgrim\appdata\local\temp\tmp2f4h7e.zip' and adding '.' to it
adding 'PURELIB\chardet-1.0.2-py3.1.egg-info'
adding 'PURELIB\chardet\big5freq.py'
adding 'PURELIB\chardet\big5prober.py'
...
adding 'PURELIB\chardet\universaldetector.py'
adding 'PURELIB\chardet\utf8prober.py'
adding 'PURELIB\chardet\__init__.py'
removing 'build\bdist.win32\wininst' (and everything under it)</samp>
<samp class=p>c:\Users\pilgrim\chardet> </samp><kbd><mark>dir dist</mark></kbd>
<samp>c:\Users\pilgrim\chardet>dir dist
 Volume in drive C has no label.
 Volume Serial Number is AADE-E29F

 Directory of c:\Users\pilgrim\chardet\dist

07/30/2009  10:14 PM    &lt;DIR>          .
07/30/2009  10:14 PM    &lt;DIR>          ..
07/30/2009  10:14 PM           371,236 <mark>chardet-1.0.2.win32.exe</mark>
07/30/2009  06:29 PM           206,440 chardet-1.0.2.zip
               2 File(s)        577,676 bytes
               2 Dir(s)  61,424,070,656 bytes free</samp></pre>

<h3 id=linux>Building Installable Packages for Other Operating Systems</h3>

<p>Distutils can help you <a href=http://docs.python.org/3.1/distutils/builtdist.html#creating-rpm-packages>build installable packages for Linux users</a>. In my opinion, this probably isn&#8217;t worth your time. If you want your software distributed for Linux, your time would be better spent working with community members who specialize in packaging software for major Linux distributions.

<p>For example, my <code>chardet</code> library is <a href=http://packages.debian.org/python-chardet>in the Debian GNU/Linux repositories</a> (and therefore <a href=http://packages.ubuntu.com/python-chardet>in the Ubuntu repositories</a> as well). I had nothing to do with this; the packages just showed up there one day. The Debian community has <a href=http://www.debian.org/doc/packaging-manuals/python-policy/>their own policies for packaging Python libraries</a>, and the Debian <code>python-chardet</code> package is designed to follow these conventions. And since the package lives in Debian&#8217;s repositories, Debian users will receive security updates and/or new versions, depending on the system-wide settings they&#8217;ve chosen to manage their own computers.

<p>The Linux packages that Distutils builds offer none of these advantages. Your time is better spent elsewhere.

<p class=a>&#x2042;

<h2 id=pypi>Adding Your Software to The Python Package Index</h2>

<p>Uploading software to the Python Package Index is a three step process.

<ol>
<li>Register yourself
<li>Register your software
<li>Upload the packages you created with <code>setup.py sdist</code> and <code>setup.py bdist_*</code>
</ol>

<p>To register yourself, go to <a href="http://pypi.python.org/pypi?:action=register_form">the PyPI user registration page</a>. Enter your desired username and password, provide a valid email address, and click the <code>Register</code> button. (If you have a <abbr>PGP</abbr> or <abbr>GPG</abbr> key, you can also provide that. If you don&#8217;t have one or don&#8217;t know what that means, don&#8217;t worry about it.) Check your email; within a few minutes, you should receive a message from PyPI with a validation link. Click the link to complete the registration process.

<p>Now you need to register your software with PyPI and upload it. You can do this all in one step.

<pre class=screen>
<a><samp class=p>c:\Users\pilgrim\chardet> </samp><kbd>c:\python31\python.exe setup.py register sdist bdist_wininst upload</kbd>  <span class=u>&#x2460;</span></a>
<samp>running register
We need to know who you are, so please choose either:
 1. use your existing login,
 2. register as a new user,
 3. have the server generate a new password for you (and email it to you), or
 4. quit</samp>
<a><samp class=p>Your selection [default 1]:  </samp><kbd>1</kbd>                                                                 <span class=u>&#x2461;</span></a>
<a><samp class=p>Username: </samp><kbd>MarkPilgrim</kbd>                                                                          <span class=u>&#x2462;</span></a>
<samp class=p>Password:</samp>
<a><samp>Registering chardet to http://pypi.python.org/pypi</samp>                                             <span class=u>&#x2463;</span></a>
<samp>Server response (200): OK</samp>
<a><samp>running sdist</samp>                                                                                  <span class=u>&#x2464;</span></a>
<samp>... output trimmed for brevity ...</samp>
<a><samp>running bdist_wininst</samp>                                                                          <span class=u>&#x2465;</span></a>
<samp>... output trimmed for brevity ...</samp>
<a><samp>running upload</samp>                                                                                 <span class=u>&#x2466;</span></a>
<samp>Submitting dist\chardet-1.0.2.zip to http://pypi.python.org/pypi
Server response (200): OK
Submitting dist\chardet-1.0.2.win32.exe to http://pypi.python.org/pypi
Server response (200): OK
I can store your PyPI login so future submissions will be faster.
(the login will be stored in c:\home\.pypirc)</samp>
<a><samp class=p>Save your login (y/N)?</samp><kbd class=pp>n</kbd>                                                                        <span class=u>&#x2467;</span></a></pre>
<ol>
<li>When you release your project for the first time, Distutils will add your software to the Python Package Index and give it its own <abbr>URL</abbr>. Every time after that, it will simply update the project metadata with any changes you may have made in your <code>setup.py</code> parameters. Next, it builds a source distribution (<code>sdist</code>) and a Windows installer (<code>bdist_wininst</code>), then uploads them to PyPI (<code>upload</code>).
<li>Type <kbd>1</kbd> or just press <kbd>ENTER</kbd> to select &#8220;use your existing login.&#8221;
<li>Enter the username and password you selected on the <a href="http://pypi.python.org/pypi?:action=register_form">the PyPI user registration page</a>. Distuils will not echo your password; it will not even echo asterisks in place of characters. Just type your password and press <kbd>ENTER</kbd>.
<li>Distutils registers your package with the Python Package Index&hellip;
<li>&hellip;builds your source distribution&hellip;
<li>&hellip;builds your Windows installer&hellip;
<li>&hellip;and uploads them both to the Python Package Index.
<li>If you want to automate the process of releasing new versions, you need to save your PyPI credentials in a local file. This is completely insecure and completely optional.
</ol>

<p>Congratulations, you now have your own page on the Python Package Index! The address is <code>http://pypi.python.org/pypi/<i>NAME</i></code>, where <i>NAME</i> is the string you passed in the <var>name</var> parameter in your <code>setup.py</code> file.

<p>If you want to release a new version, just update your <code>setup.py</code> with the new version number, then run the same upload command again:

<pre class='nd screen'>
<samp class=p>c:\Users\pilgrim\chardet> </samp><kbd>c:\python31\python.exe setup.py register sdist bdist_wininst upload</kbd>
</pre>

<p class=a>&#x2042;

<h2 id=future>The Many Possible Futures of Python Packaging</h2>

<p>Distutils is not the be-all and end-all of Python packaging, but as of this writing (August 2009), it&#8217;s the only packaging framework that works in Python 3. There are a number of other frameworks for Python 2; some focus on installation, others on testing and deployment. Some or all of these may end up being ported to Python 3 in the future.

<p>These frameworks focus on installation:

<ul>
<li><a href=http://pypi.python.org/pypi/setuptools>Setuptools</a>
<li><a href=http://pypi.python.org/pypi/pip>Pip</a>
<li><a href=http://bitbucket.org/tarek/distribute/>Distribute</a>
</ul>

<p>These focus on testing and deployment:

<ul>
<li><a href=http://pypi.python.org/pypi/virtualenv><code>virtualenv</code></a>
<li><a href=http://pypi.python.org/pypi/zc.buildout><code>zc.buildout</code></a>
<li><a href=http://www.blueskyonmars.com/projects/paver/>Paver</a>
<li><a href=http://fabfile.org/>Fabric</a>
<li><a href=http://www.py2exe.org/><code>py2exe</code></a>
</ul>

<p class=a>&#x2042;

<h2 id=furtherreading>Further Reading</h2>

<p>On Distutils:

<ul>
<li><a href=http://docs.python.org/3.1/distutils/>Distributing Python Modules with Distutils</a>
<li><a href=http://docs.python.org/3.1/distutils/apiref.html#module-distutils.core>Core Distutils functionality</a> lists all the possible arguments to the <code>setup()</code> function
<li><a href=http://wiki.python.org/moin/Distutils/Cookbook>Distutils Cookbook</a>
<li><a href=http://www.python.org/dev/peps/pep-0370/><abbr>PEP</abbr> 370: Per user <code>site-packages</code> directory</a>
<li><a href=http://jessenoller.com/2009/07/19/pep-370-per-user-site-packages-and-environment-stew/><abbr>PEP</abbr> 370 and &#8220;environment stew&#8221;</a>
</ul>

<p>On other packaging frameworks:

<ul>
<li><a href=http://groups.google.com/group/django-developers/msg/5407cdb400157259>The Python packaging ecosystem</a>
<li><a href=http://www.b-list.org/weblog/2008/dec/14/packaging/>On packaging</a>
<li><a href=http://blog.ianbicking.org/2008/12/14/a-few-corrections-to-on-packaging/>A few corrections to &#8220;On packaging&#8221;</a>
<li><a href=http://www.b-list.org/weblog/2008/dec/15/pip/>Why I like Pip</a>
<li><a href=http://cournape.wordpress.com/2009/04/01/python-packaging-a-few-observations-cabal-for-a-solution/>Python packaging: a few observations</a>
<li><a href=http://jacobian.org/writing/nobody-expects-python-packaging/>Nobody expects Python packaging!</a>
</ul>

<p class=v><a rel=prev href=case-study-porting-chardet-to-python-3.html title='back to &#8220;Case Study: Porting chardet to Python 3&#8221;'><span class=u>&#x261C;</span></a> <a rel=next href=porting-code-to-python-3-with-2to3.html title='onward to &#8220;Porting Code to Python 3 with 2to3&#8221;'><span class=u>&#x261E;</span></a>
<p class=c>&copy; 2001&ndash;10 <a href=about.html>Mark Pilgrim</a>
<script src=j/jquery.js></script>
<script src=j/prettify.js></script>
<script src=j/dip3.js></script>
